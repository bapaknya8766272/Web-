<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Super Admin - ALFA Hosting</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #f0f2f5; font-family: 'Segoe UI', sans-serif; margin: 0; }
        
        /* HEADER */
        .admin-header { background: linear-gradient(135deg, #2c3e50, #1a252f); color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); position: sticky; top: 0; z-index: 100; }
        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        
        /* CARDS */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: relative; overflow: hidden; transition: transform 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .card h3 { margin: 0; color: #7f8c8d; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        .card .number { font-size: 2.2rem; font-weight: 800; color: #2980b9; margin-top: 10px; }
        .card .icon { position: absolute; right: 20px; bottom: 20px; font-size: 3.5rem; opacity: 0.1; color: #2980b9; }

        /* CHARTS */
        .charts-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .chart-box { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

        /* TABLES */
        .panel-section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #f4f4f4; padding-bottom: 15px; }
        .table-responsive { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; color: #2c3e50; padding: 15px; text-align: left; font-weight: 700; border-bottom: 2px solid #ddd; }
        td { padding: 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
        
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: 600; font-size: 0.9rem; margin-right:5px; }
        .btn-primary { background: #3498db; } .btn-success { background: #27ae60; } .btn-danger { background: #e74c3c; } .btn-warning { background: #f39c12; }
        
        /* FORM MODAL (Hidden by default) */
        .form-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; display:none; justify-content:center; align-items:center; }
        .form-box { background:white; padding:30px; width:400px; border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,0.2); }
        
        /* LOGIN OVERLAY (Visible by default - FIX UTAMA) */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1c20; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .login-box { background: white; padding: 40px; border-radius: 15px; width: 350px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        
        .form-group { margin-bottom:15px; text-align:left; }
        .form-group label { display:block; margin-bottom:5px; font-weight:bold; }
        .form-group input, .form-group select, .form-group textarea { width:100%; padding:10px; border:1px solid #ddd; border-radius:5px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <h2 style="color:white; margin-bottom:20px;">ALFA ADMIN</h2>
        <div class="login-box">
            <h3>Login Dashboard</h3>
            <input type="password" id="admin-pass" placeholder="Password..." style="width:100%; padding:12px; margin:15px 0; border:1px solid #ddd; border-radius:6px;">
            <button class="btn btn-primary" onclick="checkLogin()" style="width:100%; padding:12px; justify-content:center;">MASUK</button>
            <p id="error-msg" style="color:red; display:none; margin-top:10px;">Password Salah!</p>
        </div>
    </div>

    <div id="admin-content" style="display:none;">
        <div class="admin-header">
            <div><i class="fas fa-chart-line"></i> DASHBOARD</div>
            <div>
                <a href="index.html" class="btn btn-primary" target="_blank">Lihat Website</a>
                <button class="btn btn-danger" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="container">
            <div class="dashboard-grid">
                <div class="card"><h3>Pendapatan</h3><div class="number" id="stat-revenue" style="color:#27ae60;">Rp 0</div><i class="fas fa-wallet icon"></i></div>
                <div class="card"><h3>Pengunjung</h3><div class="number" id="stat-visits">0</div><i class="fas fa-users icon"></i></div>
                <div class="card"><h3>Transaksi</h3><div class="number" id="stat-orders">0</div><i class="fas fa-shopping-cart icon"></i></div>
                <div class="card"><h3>Produk Laris</h3><div class="number" id="stat-best" style="font-size:1.4rem; margin-top:15px;">-</div><i class="fas fa-star icon"></i></div>
            </div>

            <div class="charts-container">
                <div class="chart-box"><h4>Grafik Penjualan</h4><canvas id="salesChart"></canvas></div>
                <div class="chart-box"><h4>Kategori Terjual</h4><canvas id="categoryChart"></canvas></div>
            </div>

            <div class="panel-section">
                <div class="section-header">
                    <h3><i class="fas fa-box-open"></i> Manajemen Produk & Stok</h3>
                    <div>
                        <button class="btn btn-warning" onclick="resetDefaultProducts()"><i class="fas fa-sync"></i> Reset</button>
                        <button class="btn btn-success" onclick="openProductModal()">+ Tambah</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table>
                        <thead><tr><th>Produk</th><th>Kategori</th><th>Harga</th><th>Stok</th><th>Aksi</th></tr></thead>
                        <tbody id="product-list-body"></tbody>
                    </table>
                </div>
            </div>

            <div class="panel-section">
                <div class="section-header">
                    <h3><i class="fas fa-history"></i> Riwayat Pembayaran</h3>
                    <button class="btn btn-danger" onclick="clearHistory()">Hapus Riwayat</button>
                </div>
                <div class="table-responsive">
                    <table>
                        <thead><tr><th>Tanggal</th><th>Item</th><th>Total</th><th>Status</th></tr></thead>
                        <tbody id="sales-history-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="product-modal" class="form-overlay">
        <div class="form-box">
            <h3 id="modal-title">Edit Produk</h3>
            <input type="hidden" id="prod-index">
            <div class="form-group"><label>Nama</label><input type="text" id="prod-name"></div>
            <div class="form-group"><label>Kategori</label><select id="prod-cat" onchange="toggleStockInput()"><option value="vps">VPS</option><option value="panel">Panel</option><option value="other">Lainnya</option></select></div>
            <div class="form-group" id="stock-group"><label>Stok</label><input type="number" id="prod-stock"></div>
            <div class="form-group"><label>Harga</label><input type="number" id="prod-price"></div>
            <div class="form-group"><label>Deskripsi</label><textarea id="prod-desc" rows="3"></textarea></div>
            <div class="form-group"><label><input type="checkbox" id="prod-rec"> Unggulan</label></div>
            <div style="display:flex; gap:10px;"><button class="btn btn-primary" onclick="saveProduct()" style="flex:1;">SIMPAN</button><button class="btn btn-danger" onclick="closeProductModal()" style="flex:1;">BATAL</button></div>
        </div>
    </div>

    <script src="scripts.js"></script>
    <script>
        // LOGIN LOGIC - FIX BLANK SCREEN
        const SECRET_HASH = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9"; 
        
        async function sha256(m){const b=new TextEncoder().encode(m);const h=await crypto.subtle.digest('SHA-256',b);return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join('')}
        
        async function checkLogin(){
            const i=document.getElementById('admin-pass').value;
            if(await sha256(i)===SECRET_HASH){
                sessionStorage.setItem('auth','true');
                showAdmin();
            } else {
                document.getElementById('error-msg').style.display='block';
            }
        }
        
        function showAdmin(){
            document.getElementById('login-overlay').style.display='none';
            document.getElementById('admin-content').style.display='block';
            try { loadAllData(); } catch(e) { console.error(e); }
        }
        
        function logout(){ sessionStorage.clear(); location.reload(); }
        
        // Cek Login saat load
        window.onload = function(){
            if(sessionStorage.getItem('auth') === 'true') {
                showAdmin();
            } else {
                document.getElementById('login-overlay').style.display='flex';
            }
        }

        // --- DASHBOARD LOGIC ---
        function formatRupiah(n){return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0}).format(n);}
        function loadAllData(){ loadProductsAdmin(); loadHistoryAndStats(); }

        // PRODUK
        function loadProductsAdmin() {
            let products = JSON.parse(localStorage.getItem('products'));
            // Jika kosong, ambil default dari scripts.js (karena file scripts.js sudah di-include)
            if (!products || products.length === 0) {
                if(typeof defaultProducts !== 'undefined') {
                    products = defaultProducts;
                    localStorage.setItem('products', JSON.stringify(products));
                } else {
                    products = [];
                }
            }
            const tbody = document.getElementById('product-list-body'); tbody.innerHTML = '';
            products.forEach((p, index) => {
                let stockLabel = (p.category !== 'other') ? (p.stock > 0 ? `<span style="color:#27ae60;font-weight:bold;">${p.stock}</span>` : `<span style="color:red;font-weight:bold;">HABIS</span>`) : `<span style="color:#999;">-</span>`;
                tbody.innerHTML += `<tr><td><strong>${p.name}</strong> ${p.recommend?'â˜…':''}</td><td><span style="background:#eee;padding:3px 8px;border-radius:4px;">${p.category}</span></td><td>${formatRupiah(p.price)}</td><td>${stockLabel}</td><td><button class="btn btn-primary" onclick="editProductAdmin(${index})"><i class="fas fa-edit"></i></button><button class="btn btn-danger" onclick="deleteProductAdmin(${index})"><i class="fas fa-trash"></i></button></td></tr>`;
            });
        }

        // STATS & CHARTS
        function loadHistoryAndStats() {
            const h = JSON.parse(localStorage.getItem('salesHistory')) || [];
            document.getElementById('stat-visits').innerText = localStorage.getItem('total_visits') || 0;
            const tb = document.getElementById('sales-history-body'); tb.innerHTML='';
            let rev=0, counts={}, catData={'VPS':0,'Panel':0,'Lainnya':0};
            
            h.slice().reverse().forEach(i => {
                let t = i.price*i.quantity; rev+=t;
                if(counts[i.service]) counts[i.service]+=i.quantity; else counts[i.service]=i.quantity;
                let n=i.service.toLowerCase(); if(n.includes('vps'))catData['VPS']+=i.quantity;else if(n.includes('panel'))catData['Panel']+=i.quantity;else catData['Lainnya']+=i.quantity;
                tb.innerHTML+=`<tr><td>${i.date||'-'}</td><td>${i.service}</td><td>${formatRupiah(t)}</td><td><span style="background:#27ae60;color:white;padding:2px 8px;border-radius:10px;">Lunas</span></td></tr>`;
            });

            document.getElementById('stat-revenue').innerText=formatRupiah(rev);
            document.getElementById('stat-orders').innerText=h.length;
            let best='-'; let max=0; for(const[p,c]of Object.entries(counts)){if(c>max){max=c;best=p;}}
            document.getElementById('stat-best').innerText=best;

            if(window.mySales) window.mySales.destroy(); if(window.myCat) window.myCat.destroy();
            window.mySales = new Chart(document.getElementById('salesChart'), {type:'line', data:{labels:h.map((_,i)=>`Ord ${i+1}`), datasets:[{label:'Transaksi',data:h.map(i=>i.price*i.quantity),borderColor:'#3498db',fill:true}]}});
            window.myCat = new Chart(document.getElementById('categoryChart'), {type:'doughnut', data:{labels:['VPS','Panel','Lainnya'], datasets:[{data:[catData['VPS'],catData['Panel'],catData['Lainnya']],backgroundColor:['#3498db','#e74c3c','#f1c40f']}]}});
        }

        function toggleStockInput(){ const cat=document.getElementById('prod-cat').value; document.getElementById('stock-group').style.display=(cat==='other')?'none':'block'; }
        const modal=document.getElementById('product-modal');
        function openProductModal(){ modal.style.display='flex'; document.getElementById('modal-title').innerText="Tambah"; document.getElementById('prod-index').value=""; document.getElementById('prod-name').value=""; document.getElementById('prod-price').value=""; document.getElementById('prod-stock').value="50"; document.getElementById('prod-desc').value=""; document.getElementById('prod-rec').checked=false; toggleStockInput(); }
        function closeProductModal(){ modal.style.display='none'; }
        function editProductAdmin(idx){ let p=JSON.parse(localStorage.getItem('products'))[idx]; modal.style.display='flex'; document.getElementById('modal-title').innerText="Edit"; document.getElementById('prod-index').value=idx; document.getElementById('prod-name').value=p.name; document.getElementById('prod-cat').value=p.category; document.getElementById('prod-price').value=p.price; document.getElementById('prod-stock').value=p.stock||0; document.getElementById('prod-desc').value=p.desc; document.getElementById('prod-rec').checked=p.recommend; toggleStockInput(); }
        function saveProduct(){ let p=JSON.parse(localStorage.getItem('products'))||[]; let idx=document.getElementById('prod-index').value; let cat=document.getElementById('prod-cat').value; let st=(cat!=='other')?parseInt(document.getElementById('prod-stock').value)||0:0; let newItem={id:Date.now().toString(),name:document.getElementById('prod-name').value,category:cat,price:parseInt(document.getElementById('prod-price').value),stock:st,desc:document.getElementById('prod-desc').value,recommend:document.getElementById('prod-rec').checked}; if(idx==="")p.push(newItem); else p[idx]=newItem; localStorage.setItem('products',JSON.stringify(p)); closeProductModal(); loadProductsAdmin(); }
        function deleteProductAdmin(idx){ if(confirm("Hapus?")){let p=JSON.parse(localStorage.getItem('products')); p.splice(idx,1); localStorage.setItem('products',JSON.stringify(p)); loadProductsAdmin();} }
        function resetDefaultProducts(){ if(confirm("Reset database?")){localStorage.removeItem('products'); location.reload();} }
        function clearHistory(){ if(confirm("Hapus Riwayat?")){localStorage.removeItem('salesHistory'); loadAllData();} }
    </script>
</body>
</html>